version: '3.8'

x-openclaw-defaults: &default-config
  build:
    context: .
    dockerfile: .Dockerfile
  volumes:
    # Shared configuration (Models, Token usually same for cluster, or separate if needed)
    - ./config:/app/config
  env_file:
    - .env
  environment:
    - OPENCLAW_CONFIG_PATH=/app/config/openclaw.json
  restart: unless-stopped

services:
  # Instance 1: Default Ports (18789 / 8080)
  openclaw-1:
    <<: *default-config
    container_name: openclaw-1
    ports:
      - "18789:18789"
      - "8080:8080"
    volumes:
      # Scripts/Code mount
      - /container/openclaw-1/scripts:/app
      - ./config:/app/config
      # Persistent State for Instance 1
      - ./data/instance1/state:/root/.openclaw
      - ./data/instance1/data:/app/data
      - pm2-data-1:/app/.pm2

  # Instance 2: Mapped to 18790 / 8081
  openclaw-2:
    <<: *default-config
    container_name: openclaw-2
    ports:
      - "18790:18789"
      - "8081:8080"
    volumes:
      # Scripts/Code mount
      - /container/openclaw-2/scripts:/app
      - ./config:/app/config
      # Persistent State for Instance 2
      - ./data/instance2/state:/root/.openclaw
      - ./data/instance2/data:/app/data
      - pm2-data-2:/app/.pm2

  # Instance 3: Mapped to 18791 / 8082
  openclaw-3:
    <<: *default-config
    container_name: openclaw-3
    ports:
      - "18791:18789"
      - "8082:8080"
    volumes:
      # Scripts/Code mount
      - /container/openclaw-3/scripts:/app
      - ./config:/app/config
      # Persistent State for Instance 3
      - ./data/instance3/state:/root/.openclaw
      - ./data/instance3/data:/app/data
      - pm2-data-3:/app/.pm2

volumes:
  pm2-data-1:
  pm2-data-2:
  pm2-data-3: